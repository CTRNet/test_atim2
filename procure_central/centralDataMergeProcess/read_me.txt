-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- PROCURE 
--   Commande Lines to create the atim dump of a ATiM bank installation to populate the ATiM-Central
--
-- @author: N. Luc.
-- @creation_date : 2017-03-28
-- @update_date : 2017-03-28
-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

mysqldump -u {login} -p{password} procurechus --tables ad_bags ad_blocks ad_cell_cores ad_cell_slides ad_envelopes ad_gel_matrices ad_tissue_cores ad_tissue_slides ad_tubes ad_whatman_papers ad_xenograft_cores ad_xenograft_slides aliquot_controls aliquot_internal_uses aliquot_masters aliquot_masters_revs aliquot_review_controls aliquot_review_masters collections consent_controls consent_masters derivative_details drugs event_controls event_masters misc_identifier_controls misc_identifiers misc_identifier_controls order_items orders parent_to_derivative_sample_controls participant_messages participants procure_ar_tissue_slides procure_cd_sigantures procure_ed_clinical_exams procure_ed_clinical_notes procure_ed_lab_pathologies procure_ed_laboratories procure_ed_other_tumor_diagnosis procure_ed_prostate_cancer_diagnosis procure_ed_questionnaires procure_ed_visits procure_spr_prostate procure_txd_treatments quality_ctrls realiquotings sample_controls sample_masters sd_der_amp_rnas sd_der_ascite_cells sd_der_ascite_sups sd_der_b_cells sd_der_blood_cells sd_der_bone_marrow_susps sd_der_buffy_coats sd_der_cdnas sd_der_cell_cultures sd_der_cell_lysates sd_der_csf_cells sd_der_csf_sups sd_der_cystic_fl_cells sd_der_cystic_fl_sups sd_der_dnas sd_der_no_b_cells sd_der_pbmcs sd_der_pericardial_fl_cells sd_der_pericardial_fl_sups sd_der_plasmas sd_der_pleural_fl_cells sd_der_pleural_fl_sups sd_der_proteins sd_der_pw_cells sd_der_pw_sups sd_der_rnas sd_der_serums sd_der_tiss_lysates sd_der_tiss_susps sd_der_urine_cents sd_der_urine_cons sd_der_xenografts sd_spe_ascites sd_spe_bloods sd_spe_bone_marrows sd_spe_cord_bloods sd_spe_csfs sd_spe_cystic_fluids sd_spe_nails sd_spe_pericardial_fluids sd_spe_peritoneal_washes sd_spe_pleural_fluids sd_spe_salivas sd_spe_stools sd_spe_tissues sd_spe_urines sd_spe_vaginal_swabs sd_xeno_blood_cells sd_xeno_bloods sd_xeno_dnas sd_xeno_pbmcs sd_xeno_plasmas sd_xeno_rnas sd_xeno_serums sd_xeno_tissues shipments source_aliquots specimen_details specimen_review_controls specimen_review_masters std_boxs std_cupboards std_customs std_freezers std_fridges std_incubators std_nitro_locates std_racks std_rooms std_shelfs std_tma_blocks storage_controls storage_coordinates storage_masters storage_masters_revs structure_permissible_values_custom_controls structure_permissible_values_customs study_fundings study_investigators study_summaries tma_slides treatment_controls treatment_extend_controls treatment_masters > dump_atim_procure_chus_temp.sql
mysql -u {login} -p{password} -e "drop database if exists atim_procure_chus_copy_for_central"
mysql -u {login} -p{password} -e "create database atim_procure_chus_copy_for_central"
mysql -u {login} -p{password} atim_procure_chus_copy_for_central --default-character-set=utf8 < dump_atim_procure_chus_temp.sql
mysql -u {login} -p{password} atim_procure_chus_copy_for_central -e "UPDATE participants SET first_name = null, last_name = null"
mysql -u {login} -p{password} atim_procure_chus_copy_for_central -e "UPDATE participants SET date_of_birth = CONCAT(SUBSTR(date_of_birth, 1, 4),'-01-01'), date_of_birth_accuracy = 'm' WHERE date_of_birth_accuracy IN ('c','d')"
mysql -u {login} -p{password} atim_procure_chus_copy_for_central -e "DELETE FROM misc_identifiers misc_identifier_controls WHERE misc_identifier_control_id != (SELECT id FROM misc_identifier_controls WHERE misc_identifier_name = 'participant study number')"
mysql -u {login} -p{password} atim_procure_chus_copy_for_central -e "UDPATE procure_ed_lab_pathologies SET path_number = ''"
mysql -u {login} -p{password} atim_procure_chus_copy_for_central -e "UDPATE sd_spe_tissues SET procure_report_number = ''"
mysql -u {login} -p{password} atim_procure_chus_copy_for_central -e "CREATE TABLE atim_procure_dump_information (created datetime NOT NULL)";
mysql -u {login} -p{password} atim_procure_chus_copy_for_central -e "INSERT INTO atim_procure_dump_information (created) (SELECT NOW() FROM aliquot_controls LIMIT 0 ,1)";
del dump_atim_procure_chus_temp.sql
mysqldump -u {login} -p{password} 	atim_procure_chus_copy_for_central >  atim_procure_chus_copy_for_central.sql
